dependencies:
  pre:
    - 'echo "//registry.npmjs.org/:_authToken=${NPM_TOKEN}" > ~/.npmrc'
  override:
    - yarn

machine:
  environment:
    # For yarn
    PATH: "${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin"

    LOG_LEVEL: silly
    NODE_ENV: test
    PORT: 3000

    MONGO_CONNECTION_STRING: mongodb://localhost:27017/dummy
    MONGO_TEST_CONNECTION_STRING: mongodb://localhost:27017/dummy-test

  node:
    version: "8.4.0"

  timezone: America/Los_Angeles

test:
  override:
    - yarn test

deployment:
  release:
    branch: master
    commands:
      - npm publish
